name: Build on Debian
on: [push, workflow_dispatch]

jobs:
  build-debian:
    runs-on: ubuntu-22.04
    container:
      image: debian:bookworm-slim
    steps:
      - name: Install build essentials
        run: |
          apt update && \
          DEBIAN_FRONTEND=noninteractive apt install -y --no-install-recommends \
            gcc \
            libc6-dev \
            git
      - uses: actions/checkout@v4
      - name: Build binary
        run: |
          gcc -O2 -Wall -o gnb_udp_over_tcp main.c
          chmod +x gnb_udp_over_tcp
          ./gnb_udp_over_tcp -h 2>&1 || true  # 应输出 usage（非致命错误）
      - uses: actions/upload-artifact@v4
        with:
          name: gnb-udp-over-tcp-debian-bookworm
          path: gnb_udp_over_tcp
